---
title: '01-Docker 왜 쓰나'
date: 2023/12/13
---

# 1. 도커

## 1.1 도커 설치

https://www.docker.com/ 도커 홈페이지에 접속한 뒤, Get Started 를 누릅니다. <br/ >
OS에 맞게 다운로드하고, 설치하고, 재부팅합니다.

---

## 1.2 Docker를 사용해서 배포하는 이유

우리가 서버를 돌리기 위해서는 먼저 환경이 갖춰져야 합니다.
새로 컴퓨터를 샀다거나 또는 새로 직원이 들어왔다고 생각해봅시다.
그럼 컴퓨터에 우리가 개발한 환경과 똑같이 만들어야합니다.

이를 위해 Node.js와 같은 언어 그리고 언어의 버전, 데이터베이스,
수 많은 node_modules를 버전을 맞춰서 설치해줘야 합니다. 한 두가지가 아니겠죠.

그래서 예전 회사에서는 환경을 구축하는 과정을 하나씩 캡쳐하고, 기록해서 방법을 정리해두기도 합니다.
가이드 문서가 있다고 한들 **매번 이렇게 구축하는 것은 매우 번거로운 일**입니다.
그리고 **컴퓨터 안에 컴퓨터가 또 있으니까 너무 느린 것도 문제점**이었습니다.

이를 간편하게 해주는 것이 바로 도커입니다.
부팅 등 운영체제의 핵심 기능(커널)을 공유하는 가상머신이 Docker입니다.

그래서 OS 전체를 새로 설치하지 않아도 됩니다.
즉, 신입사원이 들어오더라도 도커 파일만 주면, 도커 실행시킬줄만 알면 1시간이면 세팅 시간이 끝납니다.

> 💡 cf. Window에서는 WSL도 같이 설치해줘야 됩니다.
>
> Docker 커널 기능은 Linux로 통일되어 있습니다.
> 그래서 window, macOs, linux 등 운영체제 신경안써도 됩니다.

> 💡 도커 쓰는 이유 정리
>
> 1. 개발/배포 환경 통일
> 2. 프로그램 미리 설치
> 3. 가벼운 가상 컴퓨터

---

### 1.3 도커허브와 깃허브 차이

> Docker 컴퓨터 === 컨테이너

---

## 2. Docker란?

도커는 개발 환경 요소들이 설치된 모습을 이미지로 저장합니다. 저장한 이미지를 클라우드에 올립니다.
이미지들이 서로 연결되서 동작하는 설정을 `문서(Dockerfile)`로 저장합니다.
새 컴퓨터에 가서 복사한 문서의 내용대로 이미지를 다운받아 설치합니다.

![정적 배포](https://raw.githubusercontent.com/berenickt/image-server/main/img/docker-file.png)

> 출처 cf. https://medium.com/@darkrasid/docker%EC%99%80-vm-d95d60e56fdd

가상 머신과 비슷하다고 볼 수 있습니다. 하지만 가상머신보다 훨씬 빠르고, 자원을 효율적으로 사용합니다.
왼쪽이 가상머신, 오른쪽이 도커입니다. 도커에는 불필요한 추가적인 운영체제 설치가 필요 없습니다.

> cf. 가상머신을 활용한 도구로는 VMware, VirtualBox, Parallels(mac용) 등이 있습니다.
> 한 대의 컴퓨터에서 여러 운영체제를 동시에 수행 가능

도커 허브에서는 npm 다운 받는 것처럼 **다른 사람들이 올려놓은 이미지를 다운로드**할 수도 있습니다.
또한, 한 컴퓨터에서 다른 환경의 여러 서비스를 실행해야 하는 경우,
컨테이너로 분리되어 있기 때문에 서로 독립되어 실행 될 수 있습니다.

이것들을 모두 간단한 명령어로 실행 할 수 있습니다.

---

### 2.1 Docker-compose의 이해

여러가지 컨테이너를 다룰 때 좀더 복잡한 설정이 필요합니다.
이럴 때 Docker-compose를 사용합니다.
`docker-compose.yml` 파일을 미리 만들어서 설정을 어떻게 할지 적어둡니다.
그리고 `docker-compose up` 명령어를 입력해서 컨테이너를 실행합니다.

**docker-compose.yml 파일 예시** ( yml 파일은 들여쓰기를 꼭 지켜주셔야합니다! )

```yaml
version: '3.7'

# 컴퓨터들
services:
  # 첫번쨰 컴퓨터 이름
  my-computer:
    build:
      context: .
      dockerfile: Dockerfile
    ports:
      - 3000:3000

  # 두번째 컴퓨터 이름
  # ...
```

---

### 2.2 환경 변수 설정

Dockerfile 안에서 환경 변수를 설정하고 싶은 때는 ENV 명령어로 설정합니다.

```
ENV [key] [value]
ENV [key]=[value]
```

---

### 2.3 간단한 도커 명령어

```bash
$ docker-compose stop # 종료
$ docker ps -a # 종료된 컴퓨터 보기
$ docker rm `docker ps -a -q` # 종료된 모든 컴퓨터 삭제
$ docker images # 이미지 내용 보기
$ docker rmi `docker images -q` # 이미지 전체 삭제
$ docker system prune -a # 전체 모두 다 삭제, 켜져있는 컨테이너는 지우지 않음
```
